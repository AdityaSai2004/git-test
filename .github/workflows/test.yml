name: Run SageMaker Script

on:
  push:
    branches:
      - main

jobs:
  run-sagemaker-script:
    runs-on: ubuntu-latest

    env:
      AWS_REGION: ap-south-1 # Replace with your AWS region
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      SAGEMAKER_INSTANCE_DNS: 13.126.13.44      # Replace with your SageMaker instance DNS or IP
      SAGEMAKER_USERNAME: ec2-user  # Replace with your SageMaker instance username
      SCRIPT_PATH: /home/ec2-user/SageMaker/script.sh  # Replace with the path to your script on the SageMaker instance
      PRIVATE_KEY: -----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAg3xpAnt2K/fkpk005aujGuQGJakbhTyc2IrmHp3u12kgCnyrg7vbAluAEs4gf97BAvxhayee2hxEVLYJxP48wyJ5DXn3cZOfPdFCybbD8mpv+uYBuTHK2epkSrID9AfpDUJhnHUReOGk60okh2iqb5wg/+mguHVoxr+6DjKewQolNcxelZIyCa5VA/LnASKOmA9BQPmmSsituoZNHSLOcweasPUN634rSR+W9fByYgdbONhL/2+I5e3GtcWwPzpadJzYh7PnT7jZ324SHW6eBFmqo+tVyRql2mIRKUPFq7c6aYoOTu6Yg/Z/G4vJJlxmIsqNbJDJ2NmFt/Px36TxAwIDAQABAoIBAGjf5Z4uPZ5qVjzzHfsGwMzlDaYiUSofo3bwqwXGsMeuOPlEYUVspA4oT2owcSms0cSA628dpg2QOExc+kPfCTYXm/hMzToRJhWXgK8FkRsdHH5B0SQW/BZ+Z0pQ3OhbGt8RkGvL0IjbacCmXaaHrFHjdUrJ3QDj3RORv2QtqgSL1wvJqBb2tBpHCdTrD4F5gldhBmwSyFmnJKKvq6cnH//ujVCFjlsW7c5t6ZHge3dN7gO/y9CwwqRgqZczBf7u8Sy4DFyZVgovZKXH34yI/Yj1kiez+Se0dADJy1pRvBSmEVMhhUAVwyxMpYQyCXApf6vgeRzY3hDf7S7dRRimhMECgYEA6MHcKeSmjq97fXo5Q1NROZ1GzuAB8WYSdR5olqYeS9UyVbcxJqPluB9rscvenZ10FcS1sWQXLw8VAak85jByxElqFItleXFLqjgZoijkSOrZYCzfUnq+GbJ7bhBWnDGaciOTHm7GjDV9fCNqqYHGZEMENd9Uq0IrB2029L8StmECgYEAkJ2uFQqRWFRmQQNEvLdyI0qfefWch8CTnWxFrvLFLn/FNbNNdhQr+UVGuR0SYMFWD/2dbVaMi6FNZ9GIYwHwZVQ3sSHnqOOsoyH2U/M5qGOtFiZoAXddOsozW8lI91D5TRB8cnc+uLuROt+bBpZGsz/+G70VCziFHr7QOc+V2eMCgYEAiE/ITWyQMq4Ip1KmKIyp3BEEv/EmkiZSFu8JF3kP8x9XjCVuDpAb37nfC1A2/p2Qt5LtSYcxoKi3h7KCbNjgzZ2lF4UPl5DHXFfggzxpfV60kYOWAirKHCiP6sR8xJq0NbYp2b/MXZ6R79qaA81xz5QD6jzxzB5DLuVCMxGXtuECgYEAi4uLuoQLAifWz68eudduTL2qK14kYB4kksgyaYGbYaYrHwlYmrMWR59ggimaXUDSEfYQ3buhPO82KRLYP2lUlgJxBvyHdMHVCUkxT4qovWMJVxFSVO/gR2Vrr4sIXJWHKqTY4P9Nx6Y+mofAKNgDet4qDowi7UPpuGQ5uz8jAy8CgYB7Fwb2yPsYmrzDex30QapDQ1f5wH8bIREhdHLDk4wCuMMafOV7QcXOA3z7NKntt2fJO9SvGJosdqLqZMFNa5+eKq0v3pG9bdF7tRm4PH0WR/QxG3NlbugIZyEgJxr7IpKOMmT6u8vAyeMej8WwuoCstrU3eANEWMqAwGDduj0I2w==-----END RSA PRIVATE KEY----- 
    steps:
      - name: Configure AWS Credentials
        run: aws configure set aws_access_key_id ${{ env.AWS_ACCESS_KEY_ID }} && aws configure set aws_secret_access_key ${{ env.AWS_SECRET_ACCESS_KEY }} && aws configure set region ${{ env.AWS_REGION }}
      
      - name: Clone Repository into SageMaker Instance
        run: |
          ${{ env.PRIVATE_KEY }} > private_key.pem
          chmod 400 private_key.pem 
          cat private_key.pem
          ssh -i private_key.pem ${{ env.SAGEMAKER_USERNAME }}@${{ env.SAGEMAKER_INSTANCE_DNS }} 
          mkdir summa
